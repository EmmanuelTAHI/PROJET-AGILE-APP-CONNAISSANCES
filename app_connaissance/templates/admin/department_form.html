{% extends "_layouts/app.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<div class="grid gap-6">
  <section class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
    <div>
      <span class="inline-flex items-center gap-1.5 rounded-full border border-sky-200 bg-sky-50 px-3 py-1 text-xs font-semibold text-sky-700"><i data-lucide="building-2" class="h-3.5 w-3.5"></i> Administration</span>
      <h1 class="mt-3 text-3xl font-bold tracking-tight text-slate-900">{{ title }}</h1>
      <p class="mt-1 text-sm text-slate-600">Vue d'ensemble des équipes et des contenus.</p>
    </div>
    <a class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50" href="{% url 'departments' %}"><i data-lucide="arrow-left" class="h-4 w-4"></i> Retour aux départements</a>
  </section>
  <section class="mx-auto max-w-xl rounded-3xl border border-slate-200/80 bg-white/95 p-6 shadow-sm sm:p-8">
    <p class="mb-4 text-sm text-slate-500"><span class="font-semibold text-rose-600">*</span> Champs obligatoires</p>
    <form method="post" class="space-y-5">
      {% csrf_token %}
      <div>
        <label for="id_name" class="block text-sm font-semibold text-slate-900">Nom <span class="text-rose-600">*</span></label>
        <input type="text" name="name" id="id_name" value="{{ form.name.value|default:'' }}" maxlength="40" required class="mt-1.5 w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 shadow-sm focus:border-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-500/20" placeholder="Ex: IT, RH" />
        {% if form.name.errors %}<p class="mt-1 text-xs text-rose-600">{{ form.name.errors.0 }}</p>{% endif %}
      </div>
      <div>
        <label for="id_description" class="block text-sm font-semibold text-slate-900">Description</label>
        <textarea name="description" id="id_description" rows="2" class="mt-1.5 w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 shadow-sm focus:border-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-500/20">{{ form.description.value|default:'' }}</textarea>
      </div>
      <div>
        <label for="id_manager" class="block text-sm font-semibold text-slate-900">Responsable (manager)</label>
        <select name="manager" id="id_manager" class="mt-1.5 w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 shadow-sm focus:border-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-500/20">
          <option value="">———</option>
          {% for u in form.fields.manager.queryset %}
          <option value="{{ u.pk }}" {% if form.manager.value == u.pk %}selected{% endif %}>{{ u.get_full_name|default:u.username }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label for="id_entreprise" class="block text-sm font-semibold text-slate-900">Entreprise</label>
        <select name="entreprise" id="id_entreprise" class="mt-1.5 w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 shadow-sm focus:border-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-500/20">
          <option value="">———</option>
          {% for e in form.fields.entreprise.queryset %}
          <option value="{{ e.pk }}" {% if form.entreprise.value == e.pk %}selected{% endif %}>{{ e.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="flex flex-wrap gap-3 border-t border-slate-200 pt-5">
        <button type="submit" class="inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-sky-500 to-sky-600 px-5 py-2.5 text-sm font-semibold text-white shadow-lg shadow-sky-500/25 transition hover:from-sky-600 hover:to-sky-700"><i data-lucide="check" class="h-4 w-4"></i> Enregistrer</button>
        <a href="{% url 'departments' %}" class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-5 py-2.5 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50">Annuler</a>
      </div>
    </form>
  </section>
</div>
<script>
  if (window.InlineCreateSelect) {
    InlineCreateSelect.init({ selectId: 'id_entreprise', model: 'entreprise', canAdd: true, apiUrl: '{% url "api_reference_create" %}', modalTitle: 'Nouvelle entreprise', modalHint: 'Saisissez le nom de l\'entreprise.', labelField: 'Nom', placeholder: 'Ex: Acme Corp', successMessage: 'Entreprise ajoutée et sélectionnée.' });
  }
</script>
{% endblock %}
