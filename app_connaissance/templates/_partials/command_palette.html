<dialog id="command-palette" class="w-full max-w-2xl rounded-2xl border border-slate-200 bg-white p-0 shadow-2xl">
  <div class="p-5 sm:p-6">
    <form method="dialog">
      <button class="absolute right-3 top-3 inline-flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white text-slate-700 hover:bg-slate-50" aria-label="Fermer">✕</button>
    </form>

    <div class="flex items-center gap-3">
      <div class="rounded-full border border-slate-200 bg-slate-50 px-3 py-1 text-xs font-semibold text-slate-700">Ctrl K</div>
      <h3 class="text-lg font-bold text-slate-900">Navigation rapide</h3>
    </div>

    <div class="mt-4">
      <input
        data-cmd-input
        type="text"
        placeholder="Tape pour filtrer (ex: validation, intégration, connaissances...)"
        class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 placeholder:text-slate-400 shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-500"
        oninput="window.__cmdFilter?.(this.value)"
      />
    </div>

    <div class="mt-4 grid gap-2">
      <a class="flex items-center justify-between rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50" href="{% url 'dashboard' %}">
        <span>Tableau de bord</span>
        <span class="rounded-lg border border-slate-200 bg-slate-50 px-2 py-0.5 text-xs text-slate-600">D</span>
      </a>
      <a class="flex items-center justify-between rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50" href="{% url 'knowledge_list' %}">
        <span>Connaissances</span>
        <span class="rounded-lg border border-slate-200 bg-slate-50 px-2 py-0.5 text-xs text-slate-600">K</span>
      </a>
      <a class="flex items-center justify-between rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50" href="{% url 'knowledge_create' %}">
        <span>Publier</span>
        <span class="rounded-lg border border-slate-200 bg-slate-50 px-2 py-0.5 text-xs text-slate-600">P</span>
      </a>
      <a class="flex items-center justify-between rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50" href="{% url 'onboarding_home' %}">
        <span>Plan d’intégration</span>
        <span class="rounded-lg border border-slate-200 bg-slate-50 px-2 py-0.5 text-xs text-slate-600">I</span>
      </a>
      <a class="flex items-center justify-between rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50" href="{% url 'trainings' %}">
        <span>Formations</span>
        <span class="rounded-lg border border-slate-200 bg-slate-50 px-2 py-0.5 text-xs text-slate-600">F</span>
      </a>
      {% if frontend.role == "manager" %}
        <a class="flex items-center justify-between rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50" href="{% url 'validation_queue' %}">
          <span>Validation</span>
          <span class="rounded-lg border border-slate-200 bg-slate-50 px-2 py-0.5 text-xs text-slate-600">V</span>
        </a>
      {% endif %}
      {% if frontend.role == "admin" %}
        <a class="flex items-center justify-between rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50" href="{% url 'departments' %}">
          <span>Départements</span>
          <span class="rounded-lg border border-slate-200 bg-slate-50 px-2 py-0.5 text-xs text-slate-600">A</span>
        </a>
        <a class="flex items-center justify-between rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50" href="{% url 'users_admin' %}">
          <span>Utilisateurs</span>
          <span class="rounded-lg border border-slate-200 bg-slate-50 px-2 py-0.5 text-xs text-slate-600">U</span>
        </a>
      {% endif %}
    </div>

    <div class="mt-5 flex justify-end">
      <form method="dialog">
        <button class="inline-flex items-center justify-center rounded-xl bg-gradient-to-r from-sky-500 to-sky-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:from-sky-600 hover:to-sky-700">OK</button>
      </form>
    </div>
  </div>
</dialog>

<script>
  // petite logique de filtrage locale (sans dépendances)
  window.__cmdFilter = (q) => {
    q = (q || "").toLowerCase();
    const modal = document.getElementById("command-palette");
    if (!modal) return;
    modal.querySelectorAll("a").forEach((a) => {
      const txt = a.textContent.toLowerCase();
      a.style.display = txt.includes(q) ? "" : "none";
    });
  };
</script>

