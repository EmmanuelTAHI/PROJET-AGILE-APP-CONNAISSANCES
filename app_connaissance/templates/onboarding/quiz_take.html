{% extends "_layouts/app.html" %}

{% block title %}Quiz — {{ quiz.titre }}{% endblock %}

{% block content %}
  <div class="mx-auto max-w-2xl space-y-8">
    <header class="space-y-1">
      {% if quiz.knowledge_item %}
        <a href="{% url 'knowledge_detail' quiz.knowledge_item.id %}" class="inline-flex items-center gap-2 text-sm font-medium text-slate-500 transition hover:text-sky-600">
          <i data-lucide="arrow-left" class="h-4 w-4"></i>
          Retour à la connaissance
        </a>
      {% else %}
        <a href="{% url 'plan_integration_personnel' %}" class="inline-flex items-center gap-2 text-sm font-medium text-slate-500 transition hover:text-sky-600">
          <i data-lucide="arrow-left" class="h-4 w-4"></i>
          Retour au plan
        </a>
      {% endif %}
      <h1 class="text-3xl font-bold tracking-tight text-slate-900">{{ quiz.titre }}</h1>
      <p class="text-slate-600">Réussite à partir de <strong>{{ quiz.seuil_reussite_pct }} %</strong>. Répondez à toutes les questions puis validez.</p>
    </header>

    <form method="post" class="space-y-8">
      {% csrf_token %}
      <div class="space-y-6 rounded-2xl border border-slate-200/80 bg-white p-6 shadow-sm">
        {% for q in quiz.questions.all %}
          <fieldset class="rounded-xl border border-slate-200/80 bg-slate-50/50 p-4">
            <legend class="text-sm font-semibold text-slate-700">Question {{ forloop.counter }}</legend>
            <p class="mt-2 text-base font-medium text-slate-900">{{ q.enonce }}</p>
            <div class="mt-4 space-y-2">
              {% for choice in q.choices.all %}
                <label class="flex cursor-pointer items-center gap-3 rounded-lg border border-slate-200 bg-white px-4 py-3 transition hover:border-sky-200 hover:bg-sky-50/50">
                  <input type="radio" name="q_{{ q.id }}" value="{{ choice.id }}" class="h-4 w-4 border-slate-300 text-sky-600 focus:ring-sky-500" required />
                  <span class="text-slate-800">{{ choice.texte }}</span>
                </label>
              {% endfor %}
            </div>
          </fieldset>
        {% empty %}
          <p class="text-slate-600">Aucune question dans ce quiz.</p>
        {% endfor %}
      </div>

      <footer class="flex flex-wrap items-center gap-4">
        <button type="submit" class="inline-flex items-center gap-2 rounded-xl bg-sky-600 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-sky-500/25 transition hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2">
          <i data-lucide="send" class="h-4 w-4"></i>
          Valider le quiz
        </button>
        {% if quiz.knowledge_item %}
          <a href="{% url 'knowledge_detail' quiz.knowledge_item.id %}" class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-5 py-3 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-50">
            Annuler
          </a>
        {% else %}
          <a href="{% url 'plan_integration_personnel' %}" class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-5 py-3 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-50">
            Annuler
          </a>
        {% endif %}
      </footer>
    </form>
  </div>
{% endblock %}
